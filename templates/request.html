{% extends "base.html" %}

{% load extra_tags %}
{% block title %}
Loading
{% endblock %}

{% block content %}
<script>
    var tries = 0;
    function loadRequest() {
        var BASE_BUCKET_URL = "https://s3.amazonaws.com/mpxresults/";

        var id = "{{ image_id }}";
        var jsonURL = BASE_BUCKET_URL + id + ".json";

        $.getJSON(jsonURL)
            .fail(function() {
                tries++;
                if (tries < 20) {
                    setTimeout(loadRequest, 500);
                }
            })
            .done(function(data) {
                $.ajax('/input/', {
                    type: 'get',
                    data: {i: data.latex},
                    dataType: 'html',
                    success: function(html) {
                        $('body').append(
                            $("<div></div>").attr('align', 'middle')
                            .append(
                                $("<img/>")
                                    .attr('src', BASE_BUCKET_URL + id + ".png")
                                    .attr('class', 'img')
                            )
                        );
                        $('body').append(html);
                        evaluateCards().done(function() {
                            setupPlots();

                            setupExamples();
                            setupSavedQueries();

                            setupFactorization();

                            setupDidYouMean();

                            setupVariableChooser();

                            // TODO: finish integration with Sphinx
                            // setupDocumentation();
                        });
                    }
                });
            });
    }

    loadRequest();
</script>
{% endblock %}
